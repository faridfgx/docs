<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlgoFX </title>
	<link rel="icon" type="image/png" href="files/fxlogo.png">
	<link rel="apple-touch-icon" href="files/fxlogo.png">
    <link rel="stylesheet" href="files/afx.css">
    <style>
		/* ============================================
		AlgoFX Auto-Save â€“ Refined Theme
		============================================ */


		/* Restore notification banner */
		.autosave-banner {
		background: var(--bg-editor, #f9fafb);
		color: var(--text-primary, #1f2937);
		padding: 10px 16px;
		display: flex;
		justify-content: center;
		align-items: center;
		border-bottom: 1px solid var(--border-soft, #e5e7eb);
		font-size: 13px;
		z-index: 100;
		}


		/* Banner content */
		.banner-content {
		display: flex;
		align-items: center;
		gap: 16px;
		}


		/* Actions */
		.banner-actions {
		display: flex;
		gap: 8px;
		}


		.banner-btn {
		padding: 4px 12px;
		font-size: 12px;
		border-radius: 4px;
		cursor: pointer;
		border: 1px solid transparent;
		transition: background-color 0.15s ease, border-color 0.15s ease;
		}


		/* Restore = primary but subtle */
		.btn-restore {
		background: #2563eb;
		color: white;
		border-color: #2563eb;
		}


		.btn-restore:hover {
		background: #1d4ed8;
		}


		/* Ignore = quiet action */
		.btn-ignore {
		background: transparent;
		color: #6b7280;
		border-color: #d1d5db;
		}


		.btn-ignore:hover {
		background: #f3f4f6;
		}


		/* ============================================
		Auto-save status indicator (IDE-style)
		============================================ */
		.autosave-indicator {
		position: absolute;
		bottom: 6px;
		right: 10px;
		font-size: 14px;
		color: #059669;
		opacity: 0;
		transition: opacity 0.25s ease;
		pointer-events: none;
		font-family: inherit;
		}


		/* Controls container */
		.controls {
		position: relative;
		padding-bottom: 24px;
		}


		/* ============================================
		Dark Theme
		============================================ */
		[data-theme="dark"] .autosave-banner {
		background: #0f172a;
		color: #e5e7eb;
		}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">
                <img src="files/fxlogo.png" alt="AlgoFX Logo" class="app-logo">
                <div class="title-text">
                    <h1>AlgoFX</h1>
                    <p>ExÃ©cuteur d'algorithmes</p>
                </div>
            </div>
        </div>

        <div class="menu-bar">
            <button class="menu-btn" onclick="newFile()">ğŸ“„ Nouveau</button>
            <button class="menu-btn" onclick="document.getElementById('fileInput').click()">ğŸ“‚ Ouvrir</button>
            <button class="menu-btn" onclick="saveFile()">ğŸ’¾ Sauvegarder</button>
            <input type="file" id="fileInput" accept=".algo" onchange="openFile(event)">
            
            <div class="menu-divider"></div>
            
            <button class="menu-btn" onclick="undo()">â†¶ Annuler</button>
            <button class="menu-btn" onclick="redo()">â†· Refaire</button>
            
            <div class="menu-divider"></div>
            <button class="btn-step" onclick="runStepByStep()"> Pas Ã  Pas</button>
            <button class="btn-step" onclick="nextStep()" id="nextStepBtn" disabled> Suivant</button>
            <button class="btn-step" onclick="stopStepExecution()" id="stopStepBtn" disabled> ArrÃªter</button>
	        <div class="menu-divider"></div>
            <select class="menu-select" id="templateSelect" onchange="loadTemplate()">
                <option value="">ğŸ“š Exemples</option>
            </select>
            <button class="menu-btn" onclick="downoff()">Download</button>
            
            <button class="theme-toggle" onclick="toggleTheme()" title="Changer le thÃ¨me">
                <span id="themeIcon">ğŸŒ™</span>
            </button>
        </div>

        <!-- Auto-save banner will be inserted here dynamically -->

        <!-- Add variable visualizer panel -->
        <div id="variablePanel" class="variable-panel">
            <div class="panel-title"> Variables</div>
            <div id="variableList"></div>
        </div>

        <div class="main-content">
            <div class="editor-section">
                <div class="section-title">âœï¸ Ã‰diteur d'Algorithme</div>
                <div class="editor-wrapper">
				<div id="lineNumbers">1</div>
				<div class="code-area">
                    <div id="highlightLayer"></div>
                    <textarea id="codeEditor" spellcheck="false"></textarea>
                </div>
				</div>
                <div class="controls">
                    <button class="btn-check" onclick="checkSyntaxOnly()">âš™ï¸ Compiler</button>
					<button class="btn-run" onclick="validateAndRun()">â–¶ ExÃ©cuter</button>
                    <button class="btn-clear" onclick="clearEditor()">ğŸ—‘ï¸ Effacer</button>
                    <!-- Auto-save indicator will appear here -->
                </div>
            </div>

            <div class="output-section">
                <div class="section-title">ğŸ“º Console de Sortie</div>
                <div id="output"></div>
                <div id="inputArea" class="input-container">
                    <div id="inputPrompt"></div>
                    <div class="input-row">
                        <input type="text" id="userInput" placeholder="Entrez une valeur...">
                        <button id="submitInput" onclick="submitInput()">Envoyer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
	
    <footer class="footer">
        AlgoFX Â© 2026 â€“ By FARID MEZANE
    </footer>

    <div id="browserWarning" class="browser-warning">
        <div class="warning-box">
            <h3>âš ï¸ Important / Ù‡Ø§Ù…</h3>

            <p dir="rtl">
                <strong>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© :</strong><br>
                Ø§Ù„Ù†Ø³Ø®Ø© ØºÙŠØ± Ø§Ù„Ù…ØªØµÙ„Ø© Ø¨Ø§Ù„Ø£Ù†ØªØ±Ù†Øª Ù…Ù† AlgoFX ØªØªØ·Ù„Ø¨ Ù…ØªØµÙØ­Ù‹Ø§ Ø­Ø¯ÙŠØ«Ù‹Ø§ Ù…Ø«Ù„
                Chrome Ø£Ùˆ Edge Ø£Ùˆ Firefox.<br>
                Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©.
            </p>

            <p>
                <strong>FranÃ§ais :</strong><br>
                La version hors ligne d'AlgoFX nÃ©cessite un navigateur moderne
                (Chrome, Edge, Firefox, etc.).<br>
                Les anciens navigateurs ne sont pas pris en charge.
            </p>

            <!-- Firefox download links -->
            <div class="firefox-downloads">
                <p><strong>Mozilla Firefox :</strong></p>

                <a class="menu-btn btn-run"
                href="https://www.mediafire.com/file/9bpmi2855bfnno5/Firefox_Setup_115.0_%252832%2529.msi/file"
                target="_blank">
                TÃ©lÃ©charger Firefox 32-bit
                </a>

                <a class="menu-btn btn-run"
                href="https://www.mediafire.com/file/q8uclwrdo2lygxq/Firefox_Setup_115.0_%252864%2529.msi/file"
                target="_blank">
                TÃ©lÃ©charger Firefox 64-bit
                </a>
            </div>

            <!-- Existing actions -->
            <div class="warning-actions">
                <button class="menu-btn btn-cancel" onclick="closeWarning()">
                Annuler / Ø¥Ù„ØºØ§Ø¡
                </button>
                <button class="menu-btn btn-run" onclick="confirmDownload()">
                Continuer / Ù…ØªØ§Ø¨Ø¹Ø©
                </button>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="syntaxModal" class="syntax-modal">
        <div class="modal-box" id="modalBox">
            <div class="modal-header">
                <div class="modal-header-left">
                    <span class="modal-icon" id="modalIcon">âš ï¸</span>
                    <h3 id="modalTitle">Erreur de Syntaxe</h3>
                </div>
                <button class="modal-close-btn" onclick="closeSyntaxModal()">Ã—</button>
            </div>
            
            <div class="modal-content" id="modalContent">
                <!-- Content will be injected here -->
            </div>
            
            <div class="modal-footer">
                <button class="modal-btn" id="modalBtn" onclick="closeSyntaxModal()">Compris</button>
            </div>
        </div>
    </div>

    <script src="files/templates.js"></script>
    <script src="files/afx.js"></script>
    <script src="files/stepsyntax.js"></script>
    
    <script>
        // ============================================
        // Line Numbers and Basic Editor Functions
        // ============================================
        const editor = document.getElementById('codeEditor');
        const lineNumbers = document.getElementById('lineNumbers');

        function updateLineNumbers() {
            const lines = editor.value.split('\n').length;
            lineNumbers.textContent = Array.from({length: lines}, (_, i) => i + 1).join('\n');
        }

        // Sync scrolling between editor and line numbers
        editor.addEventListener('scroll', () => {
            lineNumbers.scrollTop = editor.scrollTop;
        });

        // Update on input
        editor.addEventListener('input', updateLineNumbers);

        // Initialize
        updateLineNumbers();

        // Theme toggle
        function toggleTheme() {
            const root = document.documentElement;
            const currentTheme = root.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            root.setAttribute('data-theme', newTheme);
            document.getElementById('themeIcon').textContent = newTheme === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        // ============================================
        // AUTO-SAVE SYSTEM
        // ============================================
        
        // Auto-save configuration
        const AUTOSAVE_DELAY = 2000; // 2 seconds after typing stops
        let autoSaveTimer = null;
        let lastManualSave = '';
        let isOpenedFile = false; // Track if current content is from an opened file

        // ============================================
        // 1. Check for auto-save on page load
        // ============================================
        function checkAutoSaveOnLoad() {
            const savedCode = localStorage.getItem('algofx_autosave');
            const timestamp = localStorage.getItem('algofx_autosave_timestamp');
            
            if (savedCode && savedCode.trim() !== '') {
                showRestoreNotification(timestamp);
            }
        }

        // ============================================
        // 2. Show restore notification banner
        // ============================================
		function showRestoreNotification(timestamp) {
		const banner = document.createElement('div');
		banner.id = 'autoSaveBanner';
		banner.className = 'autosave-banner';


		let timeText = 'rÃ©cemment';


		if (timestamp) {
		const seconds = Math.floor((Date.now() - Number(timestamp)) / 1000);


		if (seconds < 30) {
		timeText = 'il y a quelques secondes';
		} else {
		const minutes = Math.floor(seconds / 60);


		if (minutes < 60) {
		timeText = `il y a ${minutes} minute${minutes > 1 ? 's' : ''}`;
		} else {
		const hours = Math.floor(minutes / 60);


		if (hours < 24) {
		timeText = `il y a ${hours} heure${hours > 1 ? 's' : ''}`;
		} else {
		const days = Math.floor(hours / 24);
		timeText = `il y a ${days} jour${days > 1 ? 's' : ''}`;
		}
		}
		}
		}


		banner.innerHTML = `
		<div class="banner-content">
		<span>Code non sauvegardÃ© dÃ©tectÃ© (${timeText})</span>
		<div class="banner-actions">
		<button class="banner-btn btn-restore" onclick="restoreAutoSave()">Restaurer</button>
		<button class="banner-btn btn-ignore" onclick="ignoreAutoSave()">Ignorer</button>
		</div>
		</div>
		`;


		const menuBar = document.querySelector('.menu-bar');
		menuBar.parentNode.insertBefore(banner, menuBar.nextSibling);
		}

        // ============================================
        // 3. Restore auto-saved content
        // ============================================
        function restoreAutoSave() {
            const savedCode = localStorage.getItem('algofx_autosave');
            if (savedCode) {
                document.getElementById('codeEditor').value = savedCode;
                updateLineNumbers(); // Update line numbers
                isOpenedFile = false;
                lastManualSave = ''; // Mark as unsaved
            }
            removeRestoreBanner();
            showAutoSaveStatus('Code restaurÃ©');
			refreshEditor();
        }

        // ============================================
        // 4. Ignore auto-save and clear it
        // ============================================
        function ignoreAutoSave() {
            clearAutoSaveStorage();
            removeRestoreBanner();
        }

        function removeRestoreBanner() {
            const banner = document.getElementById('autoSaveBanner');
            if (banner) banner.remove();
        }

        // ============================================
        // 5. Setup auto-save on typing
        // ============================================
        function setupAutoSave() {
            const editor = document.getElementById('codeEditor');
            
            editor.addEventListener('input', () => {
                // Only auto-save if it's new work (not an opened file)
                if (!isOpenedFile) {
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(() => {
                        saveToLocalStorage();
                    }, AUTOSAVE_DELAY);
                }
            });
        }

        // ============================================
        // 6. Save to localStorage
        // ============================================
        function saveToLocalStorage() {
            const code = document.getElementById('codeEditor').value;
            
            // Only save if there's content and it's different from last manual save
            if (code.trim() !== '' && code !== lastManualSave) {
                localStorage.setItem('algofx_autosave', code);
                localStorage.setItem('algofx_autosave_timestamp', Date.now().toString());
                showAutoSaveStatus('Auto-sauvegardÃ©');
            }
        }

        // ============================================
        // 7. Show auto-save status indicator
        // ============================================
        function showAutoSaveStatus(message) {
            let indicator = document.getElementById('autoSaveIndicator');
            
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'autoSaveIndicator';
                indicator.className = 'autosave-indicator';
                document.querySelector('.controls').appendChild(indicator);
            }
            
            indicator.textContent = `âœ“ ${message}`;
            indicator.style.opacity = '1';
            
            // Fade out after 3 seconds
            setTimeout(() => {
                indicator.style.opacity = '0';
            }, 3000);
        }

        // ============================================
        // 8. Clear auto-save storage
        // ============================================
        function clearAutoSaveStorage() {
            localStorage.removeItem('algofx_autosave');
            localStorage.removeItem('algofx_autosave_timestamp');
        }

        // ============================================
        // 9. Handle page close warning
        // ============================================
        function setupBeforeUnload() {
            window.addEventListener('beforeunload', (e) => {
                const currentCode = document.getElementById('codeEditor').value;
                
                // Check if there are unsaved changes
                if (currentCode.trim() !== '' && currentCode !== lastManualSave) {
                    // Save to localStorage before leaving
                    saveToLocalStorage();
                    
                    // Show browser warning
                    e.preventDefault();
                    e.returnValue = 'Vous avez des modifications non sauvegardÃ©es. Quitter?';
                    return e.returnValue;
                }
            });
        }

        // ============================================
        // 10. Wrap existing functions with auto-save logic
        // ============================================
        
        // Store original functions
        const originalSaveFile = window.saveFile;
        const originalOpenFile = window.openFile;
        const originalNewFile = window.newFile;

        // Wrap saveFile
        if (typeof originalSaveFile === 'function') {
            window.saveFile = function() {
                originalSaveFile();
                // After successful save
                lastManualSave = document.getElementById('codeEditor').value;
                clearAutoSaveStorage();
                isOpenedFile = false;
                showAutoSaveStatus('SauvegardÃ© manuellement');
            };
        }

        // Wrap openFile
        if (typeof originalOpenFile === 'function') {
            window.openFile = function(event) {
                originalOpenFile(event);
                // After opening file
                setTimeout(() => {
                    lastManualSave = document.getElementById('codeEditor').value;
                    isOpenedFile = true;
                    clearAutoSaveStorage();
                    removeRestoreBanner();
					refreshEditor();
                }, 100);
            };
        }

        // Wrap newFile
        if (typeof originalNewFile === 'function') {
            window.newFile = function() {
                originalNewFile();
                // Reset tracking
                lastManualSave = '';
                isOpenedFile = false;
                clearAutoSaveStorage();
            };
        }

        // ============================================
        // 11. Initialize on page load
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            checkAutoSaveOnLoad();
            setupAutoSave();
            setupBeforeUnload();
        });
function refreshEditor() {
    updateLineNumbers();
    editor.dispatchEvent(new Event('input', { bubbles: true }));
}

    </script>
</body>
</html>