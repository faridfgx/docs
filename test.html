<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSDocs Notification System with AI Assistant</title>
    <style>
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        #cs-notification {
            width: calc(100% - 40px);
            max-width: 1150px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            padding: 20px;
            position: relative;
            animation: slideDown 0.5s ease-out;
        }
        
        #cs-notification .close-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 5px 10px;
            line-height: 1;
            transition: all 0.2s ease;
        }
        
        #cs-notification .close-btn:hover {
            color: #333;
            transform: scale(1.1);
        }
        
        #cs-notification a:hover {
            opacity: 0.7;
        }
        
        .ai-assistant-section {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%);
            border-radius: 10px;
            text-align: center;
        }
        
        .ai-assistant-input {
            display: flex;
            gap: 10px;
            max-width: 500px;
            margin: 15px auto 0;
            direction: rtl;
        }
        
        .ai-assistant-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #667eea;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            text-align: right;
            font-family: 'Segoe UI', 'Arial', 'Tahoma', sans-serif;
        }
        
        .ai-assistant-input button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            white-space: nowrap;
        }
        
        .ai-assistant-input button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        /* Modal Styles */
        .ai-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .ai-modal-content {
            background: white;
            margin: 5% auto;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .modal-header h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .modal-header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        .chat-container {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
            animation: messageSlide 0.3s ease;
            line-height: 1.6;
        }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            background: #667eea;
            color: white;
            margin-right: auto;
            text-align: right;
        }
        
        .ai-message {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
            text-align: right;
        }
        
        .modal-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }
        
        .modal-input-container input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
            text-align: right;
            font-family: 'Segoe UI', 'Arial', 'Tahoma', sans-serif;
        }
        
        .modal-input-container input:focus {
            border-color: #667eea;
        }
        
        .modal-input-container button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .modal-input-container button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .modal-input-container button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: pulse 1.5s ease-in-out infinite;
            margin: 0 2px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .error {
            background: #ff6b6b;
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <script>
        function createCSDocsNotification() {
            const sections = [
                { 
                    name: 'مذكرات', 
                    weight: 20,
                    message: 'هل أنت في حاجة إلى مذكرة؟ بإمكانك الإطلاع على النماذج الموجودة من',
                    link: 'https://csdocs.space/notes.html',
                    color: '#3b82f6'
                },
                { 
                    name: 'دروس', 
                    weight: 15,
                    message: 'هل تبحث عن دروس؟ يمكنك الوصول إليها من',
                    link: 'https://csdocs.space/lessons.html',
                    color: '#10b981'
                },
                { 
                    name: 'نماذج لفروض واختبارات', 
                    weight: 20,
                    message: 'هل تحتاج إلى نماذج فروض واختبارات؟ تصفح المجموعة الكاملة من',
                    link: 'https://csdocs.space/assessment-templates.html',
                    color: '#8b5cf6'
                },
                { 
                    name: 'برامج وتطبيقات', 
                    weight: 14,
                    message: 'هل تحتاج إلى برامج وتطبيقات تعليمية؟ اكتشفها من',
                    link: 'https://csdocs.space/programs.html',
                    color: '#f97316'
                },
                { 
                    name: 'كتب', 
                    weight: 9,
                    message: 'هل تبحث عن كتب مفيدة؟ تصفح المكتبة من',
                    link: 'https://csdocs.space/libririe.html',
                    color: '#ef4444'
                },
                { 
                    name: 'وثائق إضافية', 
                    weight: 9,
                    message: 'هل تحتاج إلى وثائق وتقارير إضافية؟ يمكنك الإطلاع عليها من',
                    link: 'https://csdocs.space/other-docs.html',
                    color: '#eab308'
                },
                { 
                    name: 'قوانين المخبر', 
                    weight: 8,
                    message: 'هل تحتاج إلى قوانين وتنظيمات المخبر؟ راجعها من',
                    link: 'https://csdocs.space/lab-rules.html',
                    color: '#14b8a6'
                },
                { 
                    name: 'دليل تسيير المخبر', 
                    weight: 5,
                    message: 'دليل تسيير المخبر يقدم لك كل ماتحتاجه لتنظيم مخبرك يمكنك الإطلاع عليه من',
                    link: 'https://csdocs.space/lab-guide.html',
                    color: '#14b8a6'
                }
            ];

            const motivationalQuotes = [
                "التعليم هو أقوى سلاح يمكنك استخدامه لتغيير العالم - نيلسون مانديلا",
                "المعلم الناجح هو الذي يلهم طلابه ليصبحوا أفضل مما كان يحلم به",
                "التدريس مهنة تخلق جميع المهن الأخرى",
                "كل طفل يستحق معلماً يؤمن به ويرى فيه الإمكانات",
                "التعليم ليس ملء دلو، بل إشعال نار",
                "المعلم العظيم يعلم من القلب وليس من الكتاب",
                "الهدف من التعليم هو تحويل المرايا إلى نوافذ"
            ];

            function getAlgeriaDateTime() {
                const now = new Date();
                const algeriaTime = new Date(now.toLocaleString('en-US', { timeZone: 'Africa/Algiers' }));
                return algeriaTime;
            }

            function getArabicDate() {
                const days = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
                const months = [
                    'جانفي', 'فيفري', 'مارس', 'أفريل', 'ماي', 'جوان',
                    'جويلية', 'اوت', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'
                ];
                
                const date = getAlgeriaDateTime();
                const dayName = days[date.getDay()];
                const day = date.getDate();
                const month = months[date.getMonth()];
                const year = date.getFullYear();
                
                return `${dayName} ${day} ${month} ${year}`;
            }

            function getGreeting() {
                const date = getAlgeriaDateTime();
                const hour = date.getHours();
                const dayOfWeek = date.getDay();
                const month = date.getMonth();
                const day = date.getDate();

                const isWeekend = dayOfWeek === 5 || dayOfWeek === 6;
                const isExamPeriod = (month === 10 && day >= 15) || (month === 11 && day <= 15);

                if (isExamPeriod) {
                    return "فترة الامتحانات قريبة! راجع نماذج الاختبارات";
                }

                if (isWeekend) {
                    return "عطلة نهاية أسبوع سعيدة! وقت مثالي لتحضير ملفاتك للأسبوع القادم";
                }

                if (hour >= 4 && hour < 13) {
                    return "صباح الخير! ابدأ يومك بمراجعة المذكرات";
                } else if (hour >= 13 && hour <= 20) {
                    return "مساء الخير! استمر في العمل الرائع";
                } else {
                    return "مساء الخير! لا تنسَ أخذ قسط من الراحة";
                }
            }

            function getRandomMotivation() {
                return motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
            }

            function selectRandomSection() {
                const totalWeight = sections.reduce((sum, s) => sum + s.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (let section of sections) {
                    random -= section.weight;
                    if (random <= 0) {
                        return section;
                    }
                }
                return sections[0];
            }

            const selectedSection = selectRandomSection();
            const arabicDate = getArabicDate();
            const greeting = getGreeting();
            const motivation = getRandomMotivation();

            // Create notification HTML
            const notificationHTML = `
                <div id="cs-notification" style="border: 2px solid ${selectedSection.color};">
                    <button class="close-btn" onclick="document.getElementById('cs-notification').style.display='none'">×</button>
                    
                    <div style="max-width: 650px; margin: 0 auto; text-align: center; direction: rtl;">
                        <div style="font-size: 14px; font-weight: bold; color: ${selectedSection.color}; margin-bottom: 8px;">
                            ${arabicDate}
                        </div>
                        
                        <div style="font-size: 18px; font-weight: bold; color: #333; margin-bottom: 10px;">
                            ${greeting}
                        </div>
                        
                        <div style="font-size: 14px; font-style: italic; color: #555; margin-bottom: 15px; padding: 12px; background: white; border-radius: 8px; border-right: 4px solid ${selectedSection.color}; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                            ${motivation}
                        </div>
                        
                        <div style="padding-top: 15px; border-top: 2px solid ${selectedSection.color}33; text-align: right;">
                            <p style="font-size: 16px; line-height: 1.8; color: #444; margin: 0;">
                                ${selectedSection.message} 
                                <a href="${selectedSection.link}" style="color: ${selectedSection.color}; font-weight: bold; text-decoration: none; border-bottom: 2px solid ${selectedSection.color}; transition: opacity 0.3s ease;">هنا</a>
                            </p>
                        </div>
                        
                        <div class="ai-assistant-section">
                            <div style="font-size: 16px; font-weight: bold; color: #667eea; margin-bottom: 10px;">
                                🤖 مساعد الأستاذ الذكي
                            </div>
                            <div style="font-size: 13px; color: #666; margin-bottom: 10px;">
                                اسأل عن استراتيجيات التدريس، إدارة الصف، تصميم المناهج أو أي موضوع تعليمي
                            </div>
                            <div class="ai-assistant-input">
                                <button onclick="openAIModal()">اسأل الآن</button>
                                <input type="text" id="quickAskInput" placeholder="اكتب سؤالك هنا..." onkeypress="if(event.key === 'Enter') openAIModalWithQuestion()">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Modal -->
                <div id="aiModal" class="ai-modal">
                    <div class="ai-modal-content">
                        <div class="modal-header">
                            <button class="modal-close" onclick="closeAIModal()">×</button>
                            <h2>📚 المساعد الذكي للمعلمين</h2>
                            <p>دعم تعليمي قائم على الأدلة العلمية</p>
                        </div>
                        
                        <div class="chat-container" id="chatContainer">
                            <div class="message ai-message">
                                👋 مرحباً! أنا هنا لمساعدة المعلمين بإرشادات تعليمية قائمة على الأدلة العلمية. اسألني عن استراتيجيات التدريس، إدارة الصف، تصميم المناهج، أساليب التقييم، أو أي موضوع تعليمي.
                            </div>
                        </div>
                        
                        <div class="modal-input-container">
                            <button id="sendBtn" onclick="sendMessage()">إرسال</button>
                            <input type="text" id="modalInput" placeholder="اكتب رسالتك هنا..." onkeypress="if(event.key === 'Enter') sendMessage()">
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('afterbegin', notificationHTML);
        }

        // AI Assistant Functions

        const part1 = 'AIzaSy';
        const part2 = 'Dd11yo';
        const part3 = 'KKg7Uc';
        const part4 = '0GAuzw';
        const part5 = 'aOk7wp';
        const part6 = 'FR5RV4';
        const part7 = 'EY8';
        const API_KEY = part1 + part2 + part3 + part4 + part5 + part6 + part7;
        const API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
        
        const CONFIG = {
            temperature: 0.4,
            topK: 30,
            topP: 0.90,
            maxOutputTokens: 2048,
            systemInstruction: "أنت مساعد ذكي مصمم لمساعدة المعلمين. قدم إجابات باللغة العربية مبنية على البحث الأكاديمي والمنهجيات التعليمية المثبتة والممارسات القائمة على الأدلة. عندما يكون ذلك ممكناً، أشر إلى النظريات التعليمية المعروفة أو نتائج البحوث أو الأطر التربوية. كن واضحاً ودقيقاً ومهنياً. عند مناقشة استراتيجيات التدريس، أعط الأولوية للطرق المدعومة بالبحث التربوي. حافظ دائماً على نبرة موضوعية وأكاديمية مناسبة للمعلمين. تأكد من الإجابة باللغة العربية الفصحى.",
            safetySettings: [
                { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" }
            ]
        };

        function openAIModal() {
            document.getElementById('aiModal').style.display = 'block';
            document.getElementById('modalInput').focus();
        }

        function openAIModalWithQuestion() {
            const question = document.getElementById('quickAskInput').value.trim();
            if (question) {
                openAIModal();
                document.getElementById('modalInput').value = question;
                setTimeout(() => sendMessage(), 300);
                document.getElementById('quickAskInput').value = '';
            } else {
                openAIModal();
            }
        }

        function closeAIModal() {
            document.getElementById('aiModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('aiModal');
            if (event.target === modal) {
                closeAIModal();
            }
        }

        async function sendMessage() {
            const modalInput = document.getElementById('modalInput');
            const message = modalInput.value.trim();
            if (!message) return;
            
            addMessage(message, 'user-message');
            modalInput.value = '';
            
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = true;
            modalInput.disabled = true;
            
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai-message';
            loadingDiv.innerHTML = '<span class="loading"></span> <span class="loading"></span> <span class="loading"></span>';
            loadingDiv.id = 'loading';
            document.getElementById('chatContainer').appendChild(loadingDiv);
            document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: message }] }],
                        generationConfig: {
                            temperature: CONFIG.temperature,
                            topK: CONFIG.topK,
                            topP: CONFIG.topP,
                            maxOutputTokens: CONFIG.maxOutputTokens,
                        },
                        safetySettings: CONFIG.safetySettings,
                        systemInstruction: { parts: [{ text: CONFIG.systemInstruction }] }
                    })
                });
                
                document.getElementById('loading').remove();
                
                if (!response.ok) {
                    throw new Error(`خطأ في الاتصال بالخادم: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                addMessage(aiResponse, 'ai-message');
                
            } catch (error) {
                document.getElementById('loading')?.remove();
                showError('خطأ: ' + error.message);
                console.error('Error:', error);
            } finally {
                sendBtn.disabled = false;
                modalInput.disabled = false;
                modalInput.focus();
            }
        }
        
        function addMessage(text, className) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${className}`;
            messageDiv.textContent = text;
            document.getElementById('chatContainer').appendChild(messageDiv);
            document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
        }
        
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.getElementById('chatContainer').appendChild(errorDiv);
            document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
            setTimeout(() => errorDiv.remove(), 5000);
        }

        // Initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', createCSDocsNotification);
        } else {
            createCSDocsNotification();
        }
    </script>
</body>
</html>
